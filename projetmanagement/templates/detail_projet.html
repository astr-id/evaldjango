{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>D√©tails du projet</title>
    <link rel="stylesheet" type="text/css" href="{% static 'style_detail_projet.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
{% include 'header.html' %}


<div class="in-line">
    <div class="in-line retour">
        <a href="{% url 'liste_projets' %}">
            <i class="fas fa-chevron-left back-icon" title="Retour"></i>
        </a>
        <h2>
            {{ projet.nom }}
        </h2>
    </div>
    {% if user.estGestionnaire == True %}
        <button class="btn creer-btn">
            <a href="{% url 'creer_tache' projet_id=projet.id_projet %}">
                <i class="fas fa-plus"></i> Cr√©er une nouvelle t√¢che
            </a>
        </button>
    {% endif %}
</div>

<table>
    <thead>
    <tr>
        <th>Planifi√©e</th>
        <th>En cours</th>
        <th>R√©alis√©e</th>
        <th>En pause</th>
        <th>Valid√©e</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        {% for statut, taches in taches_par_statut.items %}
            <td class="statut {{ statut }}">
                <ul>
                    {% for tache in taches %}
                        <li class="tache">

                            <div class="in-line">
                                <h3>{{ tache.libelle }}</h3>
                                <form method="post" action="{% url 'supprimer_tache' tache_id=tache.id_tache %}">
                                    {% csrf_token %}
                                    <button type="submit"><i class="fas fa-trash-alt trash-icon"></i></button>
                                </form>
                            </div>

                            {% if tache.tache_parent %}
                                <p><strong>T√¢che parente : </strong> {{ tache.tache_parent.libelle }}</p>
                            {% endif %}

                            <p><strong>Priorit√© : </strong>{% if tache.priorite == 1 %}Basse
                                üü¢{% elif tache.priorite == 2 %}Moyenne üü°{% else %}√âlev√©e üî¥{% endif %}</p>
                            <p><strong>Gestionnaire : </strong>{{ tache.gestionnaire }}</p>
                            <p><strong>Description : </strong> {{ tache.description }}</p>
                            <p><strong>Dur√©e : </strong>{{ tache.duree }} jours</p>
                            <p><strong>Date d√©but :</strong> {{ tache.date_debut|date:"d/m/Y" }}</p>
                            <p><strong>Date fin :</strong> {{ tache.date_fin|date:"d/m/Y" }}</p>
                            <p><strong>Avancement :</strong> {{ tache.avancement }} %</p>

                            <form method="post" action="{% url 'modifier_avancement_tache' tache_id=tache.id_tache %}">
                                {% csrf_token %}
                                <input type="number" name="avancement" min="0" max="100" required>
                                <button type="submit" class="btn modifier-btn">
                                    <i class="fas fa-pen" style="margin-right: 0px" ;></i>
                                </button>
                            </form>

                            <form method="post" action="{% url 'modifier_statut_tache' tache_id=tache.id_tache %}">
                                {% csrf_token %}
                                <label for="statut"><strong>Statut :</strong></label>
                                <select name="statut">
                                    <option value="Planifi√©e">Planifi√©e</option>
                                    <option value="En cours">En cours</option>
                                    <option value="R√©alis√©e">R√©alis√©e</option>
                                    <option value="En pause">En pause</option>
                                    <option value="Valid√©e">Valid√©e</option>
                                </select>
                                <button type="submit" class="btn modifier-btn">
                                    <i class="fas fa-pen" style="margin-right: 0px" ;></i>
                                </button>
                            </form>

                            {% if tache.niveau_profondeur == 0 or tache.niveau_profondeur == 1 %}
                                <button class="btn creer-btn">
                                    <a href="{% url 'creer_sous_tache' tache_id=tache.id_tache %}">
                                        <i class="fas fa-plus"></i> Ajouter sous-t√¢che</a>
                                </button>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </td>
        {% endfor %}
    </tr>
    </tbody>
</table>
</body>
</html>
